<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>R√°dio AgroSapiens</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --verde-primario: #2E7D32;
            --verde-secundario: #81C784;
        }
        
        body {
            background-color: #f8f9fa;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .radio-container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        
        .radio-dial {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            position: relative;
            margin: 2rem auto;
            cursor: pointer;
            background: linear-gradient(145deg, #2E7D32, #1B5E20);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2),
                       -5px -5px 15px rgba(255,255,255,0.1),
                       inset 5px 5px 10px rgba(0,0,0,0.2),
                       inset -5px -5px 10px rgba(255,255,255,0.1);
            overflow: visible;
            transform: rotate(0deg);
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .radio-dial::before {
            content: '';
            position: absolute;
            width: 94%;
            height: 94%;
            border-radius: 50%;
            top: 3%;
            left: 3%;
            background: linear-gradient(145deg, #1B5E20, #2E7D32);
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.3),
                       inset -2px -2px 5px rgba(255,255,255,0.1);
        }

        .tuner-handle {
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 8px rgba(255,255,255,0.5);
            border: 2px solid rgba(0,0,0,0.2);
        }

        .frequency-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.3);
            padding: 8px 20px;
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.1);
            pointer-events: none;
        }

        .dial-markers {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .dial-marker {
            position: absolute;
            width: 2px;
            height: 15px;
            background: rgba(255,255,255,0.4);
            left: 50%;
            transform-origin: bottom center;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .station-info {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 1rem 0;
        }
        
        .time-display {
            font-size: 1.5rem;
            color: var(--verde-primario);
            margin: 1rem 0;
        }

        .bold-text {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="radio-container">
        <a href="/index" class="btn btn-agro mb-3">üè† Voltar ao Painel Principal</a>
        
        <h1>üìª R√°dio Rural</h1>
        
        <div class="time-display">
            <span class="bold-text">Hora Atual:</span>
            <span id="currentTime"></span>
        </div>
        
        <div class="station-info">
            <h3 id="stationName">Sintonize uma Esta√ß√£o</h3>
            <p id="stationProgram">Programa√ß√£o atual</p>
            <audio id="radioPlayer" controls></audio>
            <div class="radio-dial" id="radioDial">
                <div class="dial-markers" id="dialMarkers"></div>
                <div class="tuner-handle" id="tunerHandle"></div>
                <div class="frequency-display" id="frequencyDisplay">87.9</div>
        </div>
    </div>

    <audio id="tuneSound" src="https://assets.mixkit.co/active_storage/sfx/2556/2556-preview.mp3"></audio>

    <script>
        const stations = [
            {
                name: "R√°dio Cultura FM",
                freq: "98.5 MHz",
                url: "https://stream.zeno.fm/qqarsc3c92quv",
                program: "Samba Antigo"
            },
            {
                name: "R√°dio Jovem Pan",
                freq: "104.9 MHz",
                url: "https://stream.zeno.fm/vlcraijc6yiuv",
                program: "Not√≠cias Locais"
            },
            {
                name: "R√°dio Sertaneja",
                freq: "87.9 MHz",
                url: "https://stream.zeno.fm/6045t1y3tm0uv",
                program: "M√∫sica Caipira"
            },
            {
                name: "R√°dio Xing√≥ FM",
                freq: "98.7 MHz",
                url: "https://audio8.cmaudioevideo.com/proxy/edson1/stream",
                program: "XING√ì FM, Noticias e M√∫sica!"
            }
        ];

        const player = document.getElementById('radioPlayer');
        const dial = document.getElementById('radioDial');
        const handle = document.getElementById('tunerHandle');
        const tuneSound = document.getElementById('tuneSound');
        let currentStation = null;

        // Atualizar rel√≥gio
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Configura√ß√£o inicial
        let rotation = 0;
        let isDragging = false;
        let startAngle = 0;

        function setRotation(angle) {
            rotation = angle;
            handle.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
        }

        // Fun√ß√£o para calcular o √¢ngulo
        function getAngle(event) {
            const rect = dial.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const x = (event.clientX || event.touches[0].clientX) - centerX;
            const y = (event.clientY || event.touches[0].clientY) - centerY;
            return Math.atan2(y, x) * (180 / Math.PI);
        }

        function playStationByAngle(angle) {
            const stationIndex = Math.floor(((angle + 360) % 360) / (360 / stations.length));
            const station = stations[stationIndex];
            if (currentStation === station) return;
            currentStation = station;
            player.src = station.url;
            player.play();
            document.getElementById('stationName').textContent = `${station.name} - ${station.freq}`;
            document.getElementById('stationProgram').textContent = station.program;
        }

        // Event listeners
        dial.addEventListener('mousedown', (e) => {
            isDragging = true;
            startAngle = getAngle(e) - rotation;
            tuneSound.play();
        });

        dial.addEventListener('touchstart', (e) => {
            isDragging = true;
            startAngle = getAngle(e.touches[0]) - rotation;
            tuneSound.play();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const angle = getAngle(e) - startAngle;
            rotateDial(angle);
            playStationByAngle(angle);
        });

        document.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            const angle = getAngle(e.touches[0]) - startAngle;
            rotateDial(angle);
            playStationByAngle(angle);
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            tuneSound.pause();
        });

        document.addEventListener('touchend', () => {
            isDragging = false;
            tuneSound.pause();
        });

        // Criar marcadores
        function createDialMarkers() {
            const markersContainer = document.getElementById('dialMarkers');
            for(let i = 0; i < 36; i++) {
                const marker = document.createElement('div');
                marker.className = 'dial-marker';
                marker.style.transform = `rotate(${i * 10}deg) translateY(10px)`;
                markersContainer.appendChild(marker);
            }
        }
        createDialMarkers();

        // Fun√ß√£o para girar o dial
        function rotateDial(angle) {
            rotation = angle;
            dial.style.transform = `rotate(${rotation}deg)`;
        }

        // Atualizar display de frequ√™ncia
        function updateFrequencyDisplay(station) {
            const display = document.getElementById('frequencyDisplay');
            display.textContent = station.freq.replace(' MHz', '');
            display.style.animation = 'pulse 0.5s ease';
            setTimeout(() => display.style.animation = '', 500);
        }

        // Modificar a fun√ß√£o playStationByAngle
        // Fun√ß√£o para tocar a esta√ß√£o
        function playStationByAngle(angle) {
            const normalizedAngle = (angle + 360) % 360;
            const stationIndex = Math.floor(normalizedAngle / (360 / stations.length));
            const station = stations[stationIndex];
            
            if (currentStation !== station) {
                currentStation = station;
                player.src = station.url;
                player.play();
                document.getElementById('stationName').textContent = station.name;
                document.getElementById('stationProgram').textContent = station.program;
                updateFrequencyDisplay(station);
            }
        }

        // Atualizar a fun√ß√£o setRotation para incluir resist√™ncia
        let lastRotation = 0;
        const rotationResistance = 0.85;

        function setRotation(angle) {
            const delta = angle - lastRotation;
            rotation = lastRotation + (delta * rotationResistance);
            lastRotation = rotation;
            handle.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
        }

        // Posicionamento inicial
        rotateDial(-45); // Ajuste inicial para alinhar as esta√ß√µes
    </script>

    <script>
        // Sistema de navega√ß√£o com transi√ß√£o
        function navigateTo(event, url) {
            event.preventDefault();
            document.body.classList.add('fade-out');
            
            setTimeout(() => {
                window.location.href = url;
            }, 500);
        }

        // Intercepta todos os cliques em links
        document.querySelectorAll('a').forEach(link => {
            if(link.href && !link.hash) { // Ignora √¢ncoras
                link.addEventListener('click', (e) => navigateTo(e, link.href));
            }
        });
    </script>
</body>
</html>